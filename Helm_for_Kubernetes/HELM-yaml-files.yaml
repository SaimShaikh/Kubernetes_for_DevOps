# Helm - YAML Files, Scripts & Practical Files

## ğŸ“‹ Chart Files for Your First Helm Chart

---

## File 1: Chart.yaml (Chart Metadata)

Save as `Chart.yaml`:

```yaml
apiVersion: v2
name: my-first-app
description: A simple Helm chart for Kubernetes
type: application
version: 1.0.0
appVersion: "1.0"
author:
  name: Your Name
  email: your@email.com
home: https://github.com/yourname/my-first-app
sources:
  - https://github.com/yourname/my-first-app
keywords:
  - kubernetes
  - helm
  - application
maintainers:
  - name: Your Name
    email: your@email.com
```

---

## File 2: values.yaml (Configuration)

Save as `values.yaml`:

```yaml
# Default values for my-first-app

# Number of replicas
replicaCount: 2

# Image configuration
image:
  repository: nginx
  pullPolicy: IfNotPresent
  tag: "latest"

# Service configuration
service:
  type: ClusterIP
  port: 80
  targetPort: 80

# Ingress configuration
ingress:
  enabled: false
  className: "nginx"
  annotations: {}
  hosts:
    - host: myapp.example.com
      paths:
        - path: /
          pathType: Prefix

# Resource limits
resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 250m
    memory: 256Mi

# Autoscaling
autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80

# Environment variables
env:
  LOG_LEVEL: info
  APP_ENV: development

# Labels
labels:
  app: my-app
  version: v1.0
```

---

## File 3: Deployment Template

Save as `templates/deployment.yaml`:

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "my-first-app.fullname" . }}
  labels:
    {{- include "my-first-app.labels" . | nindent 4 }}
spec:
  {{- if not .Values.autoscaling.enabled }}
  replicas: {{ .Values.replicaCount }}
  {{- end }}
  selector:
    matchLabels:
      {{- include "my-first-app.selectorLabels" . | nindent 6 }}
  template:
    metadata:
      labels:
        {{- include "my-first-app.selectorLabels" . | nindent 8 }}
    spec:
      containers:
      - name: {{ .Chart.Name }}
        image: "{{ .Values.image.repository }}:{{ .Values.image.tag | default .Chart.AppVersion }}"
        imagePullPolicy: {{ .Values.image.pullPolicy }}
        ports:
        - name: http
          containerPort: {{ .Values.service.targetPort }}
          protocol: TCP
        env:
        {{- range $key, $value := .Values.env }}
        - name: {{ $key }}
          value: "{{ $value }}"
        {{- end }}
        resources:
          {{- toYaml .Values.resources | nindent 12 }}
```

---

## File 4: Service Template

Save as `templates/service.yaml`:

```yaml
apiVersion: v1
kind: Service
metadata:
  name: {{ include "my-first-app.fullname" . }}
  labels:
    {{- include "my-first-app.labels" . | nindent 4 }}
spec:
  type: {{ .Values.service.type }}
  ports:
    - port: {{ .Values.service.port }}
      targetPort: http
      protocol: TCP
      name: http
  selector:
    {{- include "my-first-app.selectorLabels" . | nindent 4 }}
```

---

## File 5: Ingress Template

Save as `templates/ingress.yaml`:

```yaml
{{- if .Values.ingress.enabled -}}
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: {{ include "my-first-app.fullname" . }}
  labels:
    {{- include "my-first-app.labels" . | nindent 4 }}
spec:
  ingressClassName: {{ .Values.ingress.className }}
  rules:
  {{- range .Values.ingress.hosts }}
    - host: {{ .host | quote }}
      http:
        paths:
        {{- range .paths }}
          - path: {{ .path }}
            pathType: {{ .pathType }}
            backend:
              service:
                name: {{ include "my-first-app.fullname" $ }}
                port:
                  number: {{ $.Values.service.port }}
        {{- end }}
  {{- end }}
{{- end }}
```

---

## File 6: Helpers Template

Save as `templates/_helpers.tpl`:

```yaml
{{/*
Expand the name of the chart.
*/}}
{{- define "my-first-app.name" -}}
{{- default .Chart.Name .Values.nameOverride | trunc 63 | trimSuffix "-" }}
{{- end }}

{{/*
Create a default fully qualified app name.
*/}}
{{- define "my-first-app.fullname" -}}
{{- if .Values.fullnameOverride }}
{{- .Values.fullnameOverride | trunc 63 | trimSuffix "-" }}
{{- else }}
{{- $name := default .Chart.Name .Values.nameOverride }}
{{- if contains $name .Release.Name }}
{{- .Release.Name | trunc 63 | trimSuffix "-" }}
{{- else }}
{{- printf "%s-%s" .Release.Name $name | trunc 63 | trimSuffix "-" }}
{{- end }}
{{- end }}
{{- end }}

{{/*
Create chart name and version as used by the chart label.
*/}}
{{- define "my-first-app.chart" -}}
{{- printf "%s-%s" .Chart.Name .Chart.Version | replace "+" "_" | trunc 63 | trimSuffix "-" }}
{{- end }}

{{/*
Common labels
*/}}
{{- define "my-first-app.labels" -}}
helm.sh/chart: {{ include "my-first-app.chart" . }}
{{ include "my-first-app.selectorLabels" . }}
{{- if .Chart.AppVersion }}
app.kubernetes.io/version: {{ .Chart.AppVersion | quote }}
{{- end }}
app.kubernetes.io/managed-by: {{ .Release.Service }}
{{- end }}

{{/*
Selector labels
*/}}
{{- define "my-first-app.selectorLabels" -}}
app.kubernetes.io/name: {{ include "my-first-app.name" . }}
app.kubernetes.io/instance: {{ .Release.Name }}
{{- end }}
```

---

## File 7: NOTES.txt (Post-Installation Notes)

Save as `templates/NOTES.txt`:

```
1. Get the application URL by running these commands:
{{- if .Values.ingress.enabled }}
  http://{{ index .Values.ingress.hosts 0 "host" }}
{{- else if contains "NodePort" .Values.service.type }}
  export NODE_PORT=$(kubectl get --namespace {{ .Release.Namespace }} -o jsonpath="{.spec.ports[0].nodePort}" services {{ include "my-first-app.fullname" . }})
  export NODE_IP=$(kubectl get nodes --namespace {{ .Release.Namespace }} -o jsonpath="{.items[0].status.addresses[0].address}")
  echo http://$NODE_IP:$NODE_PORT
{{- else if contains "LoadBalancer" .Values.service.type }}
  export SERVICE_IP=$(kubectl get svc --namespace {{ .Release.Namespace }} {{ include "my-first-app.fullname" . }} -o jsonpath='{.status.loadBalancer.ingress[0].ip}')
  echo http://$SERVICE_IP:{{ .Values.service.port }}
{{- else if contains "ClusterIP" .Values.service.type }}
  export POD_NAME=$(kubectl get pods --namespace {{ .Release.Namespace }} -l "app.kubernetes.io/name={{ include "my-first-app.name" . }},app.kubernetes.io/instance={{ .Release.Name }}" -o jsonpath="{.items[0].metadata.name}")
  echo "Visit http://127.0.0.1:8080 to use your application"
  kubectl port-forward --namespace {{ .Release.Namespace }} $POD_NAME 8080:{{ .Values.service.port }}
{{- end }}

2. Watch the deployment:
  kubectl rollout status deployment/{{ include "my-first-app.fullname" . }} --namespace {{ .Release.Namespace }}

3. Get pods:
  kubectl get pods --namespace {{ .Release.Namespace }}
```

---

## File 8: Environment-Specific Values

Save as `values-prod.yaml`:

```yaml
# Production values overrides
replicaCount: 5

image:
  tag: "1.0"
  pullPolicy: Always

service:
  type: LoadBalancer

ingress:
  enabled: true
  hosts:
    - host: myapp.example.com
      paths:
        - path: /
          pathType: Prefix

resources:
  limits:
    cpu: 1000m
    memory: 1Gi
  requests:
    cpu: 500m
    memory: 512Mi

autoscaling:
  enabled: true
  minReplicas: 3
  maxReplicas: 20
  targetCPUUtilizationPercentage: 70

env:
  LOG_LEVEL: error
  APP_ENV: production
```

Save as `values-dev.yaml`:

```yaml
# Development values overrides
replicaCount: 1

image:
  tag: "latest"
  pullPolicy: Always

service:
  type: ClusterIP

ingress:
  enabled: false

resources:
  limits:
    cpu: 250m
    memory: 256Mi
  requests:
    cpu: 100m
    memory: 128Mi

autoscaling:
  enabled: false

env:
  LOG_LEVEL: debug
  APP_ENV: development
```

---

## Quick Commands Script

Save as `helm-commands.sh`:

```bash
#!/bin/bash

echo "ğŸ¯ HELM Quick Commands"

# Repository Commands
echo "
=== Repository Commands ==="
echo "Add repo: helm repo add bitnami https://charts.bitnami.com/bitnami"
echo "Update repos: helm repo update"
echo "List repos: helm repo list"
echo "Search: helm search repo wordpress"

# Create & Package
echo "
=== Create & Package ==="
echo "Create chart: helm create my-chart"
echo "Lint chart: helm lint ./my-chart"
echo "Package chart: helm package ./my-chart"
echo "Template: helm template ./my-chart"

# Install & Manage
echo "
=== Install & Manage ==="
echo "Install: helm install my-app ./chart"
echo "Install in namespace: helm install my-app ./chart -n production"
echo "Dry run: helm install my-app ./chart --dry-run --debug"
echo "With values: helm install my-app ./chart -f values-prod.yaml"
echo "List releases: helm list"
echo "Check status: helm status my-app"

# Upgrade & Rollback
echo "
=== Upgrade & Rollback ==="
echo "Upgrade: helm upgrade my-app ./chart"
echo "Upgrade with values: helm upgrade my-app ./chart -f values-prod.yaml"
echo "History: helm history my-app"
echo "Rollback: helm rollback my-app"
echo "Rollback to version 2: helm rollback my-app 2"

# Inspect
echo "
=== Inspect ==="
echo "Get values: helm get values my-app"
echo "Get manifest: helm get manifest my-app"
echo "Get notes: helm get notes my-app"

# Delete
echo "
=== Delete ==="
echo "Uninstall: helm uninstall my-app"
echo "Keep history: helm uninstall my-app --keep-history"

```

---

## Setup Script

Save as `setup-helm-chart.sh`:

```bash
#!/bin/bash

set -e

echo "ğŸ¯ Setting up Helm Chart..."

# Create directory structure
echo "Creating directory structure..."
mkdir -p my-first-chart/templates

# Create Chart.yaml
cat > my-first-chart/Chart.yaml <<'EOF'
apiVersion: v2
name: my-first-app
description: My first Helm chart
type: application
version: 1.0.0
appVersion: "1.0"
EOF

# Create values.yaml
cat > my-first-chart/values.yaml <<'EOF'
replicaCount: 2
image:
  repository: nginx
  tag: "latest"
service:
  type: ClusterIP
  port: 80
resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 250m
    memory: 256Mi
EOF

# Create templates
cat > my-first-chart/templates/deployment.yaml <<'EOF'
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ .Release.Name }}-deployment
spec:
  replicas: {{ .Values.replicaCount }}
  selector:
    matchLabels:
      app: {{ .Release.Name }}
  template:
    metadata:
      labels:
        app: {{ .Release.Name }}
    spec:
      containers:
      - name: app
        image: "{{ .Values.image.repository }}:{{ .Values.image.tag }}"
        ports:
        - containerPort: {{ .Values.service.port }}
        resources:
          limits:
            cpu: {{ .Values.resources.limits.cpu }}
            memory: {{ .Values.resources.limits.memory }}
EOF

cat > my-first-chart/templates/service.yaml <<'EOF'
apiVersion: v1
kind: Service
metadata:
  name: {{ .Release.Name }}-service
spec:
  type: {{ .Values.service.type }}
  selector:
    app: {{ .Release.Name }}
  ports:
  - port: {{ .Values.service.port }}
    targetPort: {{ .Values.service.port }}
EOF

echo "âœ… Chart created at: ./my-first-chart"
echo ""
echo "Next steps:"
echo "1. Validate: helm lint ./my-first-chart"
echo "2. Test: helm install test ./my-first-chart --dry-run --debug"
echo "3. Deploy: helm install my-app ./my-first-chart"
echo "4. Check: helm list"
echo "5. Update: helm upgrade my-app ./my-first-chart --set replicaCount=3"
echo "6. Rollback: helm rollback my-app"
echo "7. Delete: helm uninstall my-app"
```

---

## Complete Helm Workflow

Save as `helm-workflow.sh`:

```bash
#!/bin/bash

echo "ğŸš€ Complete Helm Workflow Demo"

# 1. Setup
echo "1ï¸âƒ£ Setting up Helm chart..."
helm create demo-chart
cd demo-chart

# 2. Validate
echo "2ï¸âƒ£ Validating chart..."
helm lint .

# 3. Test
echo "3ï¸âƒ£ Testing with dry-run..."
helm install test . --dry-run --debug

# 4. Install
echo "4ï¸âƒ£ Installing release..."
helm install my-app .
sleep 10

# 5. Check
echo "5ï¸âƒ£ Checking status..."
helm status my-app
kubectl get pods
kubectl get svc

# 6. Get values
echo "6ï¸âƒ£ Getting used values..."
helm get values my-app

# 7. Upgrade
echo "7ï¸âƒ£ Upgrading with new values..."
helm upgrade my-app . --set replicaCount=3

# 8. History
echo "8ï¸âƒ£ Checking history..."
helm history my-app

# 9. Rollback
echo "9ï¸âƒ£ Rolling back..."
helm rollback my-app 1

# 10. Uninstall
echo "ğŸ”Ÿ Uninstalling..."
helm uninstall my-app

cd ..
rm -rf demo-chart

echo "âœ… Workflow complete!"
```

---

## Test Different Scenarios

Save as `test-helm-chart.sh`:

```bash
#!/bin/bash

CHART="./my-first-chart"

echo "ğŸ§ª Testing Helm Chart..."

# Test 1: Lint
echo "Test 1: Linting chart..."
helm lint $CHART
if [ $? -eq 0 ]; then
    echo "âœ… Lint passed"
else
    echo "âŒ Lint failed"
    exit 1
fi

# Test 2: Template
echo "Test 2: Rendering templates..."
helm template test $CHART > /tmp/manifests.yaml
if [ $? -eq 0 ]; then
    echo "âœ… Template rendering passed"
else
    echo "âŒ Template rendering failed"
    exit 1
fi

# Test 3: Dry-run
echo "Test 3: Dry-run install..."
helm install test $CHART --dry-run --debug
if [ $? -eq 0 ]; then
    echo "âœ… Dry-run passed"
else
    echo "âŒ Dry-run failed"
    exit 1
fi

# Test 4: Values validation
echo "Test 4: Testing with custom values..."
helm template test $CHART --set replicaCount=5 > /tmp/manifests.yaml
if grep -q "replicas: 5" /tmp/manifests.yaml; then
    echo "âœ… Custom values work"
else
    echo "âŒ Custom values failed"
    exit 1
fi

# Test 5: Environment overrides
echo "Test 5: Testing environment overrides..."
helm template test $CHART -f values-prod.yaml > /tmp/manifests.yaml
if grep -q "replicas: 5" /tmp/manifests.yaml; then
    echo "âœ… Environment values work"
else
    echo "âŒ Environment values failed"
    exit 1
fi

echo ""
echo "âœ… All tests passed!"
```

---

**All files ready to use!** ğŸš€
